{
  "name": "Todo Chatbot Docker AI Agent",
  "version": "1.0.0",
  "description": "AI agent configuration for generating optimized Dockerfiles for Todo Chatbot backend and frontend",
  "author": "AI Assistant",
  "config": {
    "defaultBaseImage": {
      "backend": "python:3.11-slim",
      "frontend": "node:18-alpine"
    },
    "optimizationStrategies": {
      "backend": [
        "multi-stage builds",
        "dependency caching",
        "minimal base images",
        "security scanning"
      ],
      "frontend": [
        "multi-stage builds",
        "dependency caching",
        "production build optimization",
        "security scanning"
      ]
    },
    "security": {
      "runAsNonRoot": true,
      "dropAllCapabilities": true,
      "readOnlyRootFilesystem": true
    },
    "performance": {
      "compression": "gzip",
      "layers": {
        "separateDependencies": true,
        "optimizeLayerOrder": true
      }
    },
    "patterns": {
      "backend": {
        "dependenciesFile": "requirements.txt",
        "appDir": "/app",
        "port": 8000,
        "healthCheck": "/health"
      },
      "frontend": {
        "dependenciesFile": "package.json",
        "appDir": "/app",
        "port": 3000,
        "buildCommand": "npm run build",
        "startCommand": "npm start"
      }
    }
  },
  "templates": {
    "backend": {
      "header": [
        "# Auto-generated Dockerfile for Todo Chatbot Backend",
        "# Optimized for production deployment on Kubernetes",
        "",
        "# Use official Python runtime as a parent image",
        "FROM python:3.11-slim AS builder"
      ],
      "installDependencies": [
        "# Set environment variables",
        "ENV PYTHONDONTWRITEBYTECODE 1",
        "ENV PYTHONUNBUFFERED 1",
        "",
        "# Set the working directory in the container",
        "WORKDIR /app",
        "",
        "# Copy the dependencies file to the working directory",
        "COPY requirements.txt .",
        "",
        "# Install dependencies",
        "RUN pip install --no-cache-dir -r requirements.txt"
      ],
      "productionStage": [
        "# Production stage",
        "FROM python:3.11-slim",
        "",
        "# Create non-root user",
        "RUN addgroup --system --gid 1001 appgroup && \\",
        "    adduser --system --uid 1001 appuser --ingroup appgroup",
        "",
        "# Set the working directory in the container",
        "WORKDIR /app",
        "",
        "# Copy installed dependencies from builder stage",
        "COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages",
        "",
        "# Copy the rest of the application code",
        "COPY . .",
        "",
        "# Change ownership to non-root user",
        "RUN chown -R appuser:appgroup /app",
        "",
        "# Switch to non-root user",
        "USER appuser",
        "",
        "# Expose port for the backend service",
        "EXPOSE 8000",
        "",
        "# Run the application",
        "CMD [\"uvicorn\", \"src.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]"
      ]
    },
    "frontend": {
      "header": [
        "# Auto-generated Dockerfile for Todo Chatbot Frontend",
        "# Optimized for production deployment on Kubernetes",
        "",
        "# Use official Node runtime as a parent image",
        "FROM node:18-alpine AS builder"
      ],
      "installDependencies": [
        "# Set the working directory in the container",
        "WORKDIR /app",
        "",
        "# Copy package.json and package-lock.json (if available)",
        "COPY package.json .",
        "COPY package-lock.json* .",
        "",
        "# Install dependencies",
        "RUN npm ci --only=production"
      ],
      "buildStage": [
        "# Copy the rest of the application code",
        "COPY . .",
        "",
        "# Build the Next.js application",
        "RUN npm run build"
      ],
      "productionStage": [
        "# Production stage",
        "FROM node:18-alpine",
        "",
        "# Create non-root user",
        "RUN addgroup --system --gid 1001 appgroup && \\",
        "    adduser --system --uid 1001 appuser --ingroup appgroup",
        "",
        "# Install serve globally",
        "RUN npm install -g serve",
        "",
        "# Set the working directory in the container",
        "WORKDIR /app",
        "",
        "# Copy the built application from the builder stage",
        "COPY --from=builder /app/public ./public",
        "COPY --from=builder /app/.next ./.next",
        "COPY --from=builder /app/node_modules ./node_modules",
        "COPY --from=builder /app/package.json ./package.json",
        "",
        "# Change ownership to non-root user",
        "RUN chown -R appuser:appgroup /app",
        "",
        "# Switch to non-root user",
        "USER appuser",
        "",
        "# Expose port for the frontend service",
        "EXPOSE 3000",
        "",
        "# Run the application using serve",
        "CMD [\"serve\", \"-s\", \"public\", \"-p\", \"3000\"]"
      ]
    }
  },
  "hooks": {
    "postGeneration": [
      "docker build -t todo-backend:latest .",
      "docker build -t todo-frontend:latest ."
    ]
  }
}